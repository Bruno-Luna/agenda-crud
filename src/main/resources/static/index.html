<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
	crossorigin="anonymous">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
	href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap"
	rel="stylesheet">
<link rel="stylesheet" href="style.css">
<title>Contato_app | salve seus contatos.</title>
</head>
<body>
	<header class="bg-dark d-flex align-items-center">
		<div class="container">
			<div class="row">
				<div class="col">
					<h2>
						Contato_<span class="app">app</span>
					</h2>
				</div>
			</div>
		</div>
	</header>

	<form action="" class="bg-secondary d-flex align-items-center"
		style="height: 80vh;" id="form">
		<div class="container bg-secondary">
			<div class="row">
				<div class="col-md-2">
					<label for="id" class="form-label mt-4 text-light">ID:</label> <input
						type="text" class="form-control" id="id" readonly="readonly">
				</div>
				<div class="col">
					<label for="nome" class="form-label mt-4 text-light">Nome
						do contato:</label> <input type="text" class="form-control" id="nome"
						placeholder="Insira o nome:" required="required">
				</div>
			</div>
			<div class="row align-items-end">
				<div class="col">
					<label for="contato" class="form-label mt-3 text-light">Contato:</label>
					<input type="text" class="form-control" id="contato"
						placeholder="Digite o n√∫mero do contato:">
				</div>
			</div>
			<div class="content-btn">
				<button type="button" class="salvar" onclick="salvar()">Salvar</button>

				<button type="button" class="limpar" onclick="limpar()">Limpar</button>

				<button type="button" class="salvar" data-bs-toggle="modal"
					data-bs-target="#modalPesquisar" onclick="">üîç</button>

			</div>
		</div>
	</form>


	<!-- MODAL -->

	<div class="modal fade" id="modalPesquisar" tabindex="-1"
		aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="exampleModalLabel">Lista de
						Contatos:</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form>
						<div class="mb-3">
							<label for="nomeBuscar" class="col-form-label nomeContato">Nome
								do contato:</label> <input type="text" class="form-control"
								id="nomeBuscar" placeholder="Fa√ßa sua busca aqui...">
						</div>

						<button type="button" class="btnBuscar mb-3" onclick="buscar()">Buscar</button>

					</form>

					<div style="height: 40vh; width: 100%; overflow-y: auto;">
						<table class="table" id="tabelaResultado">
							<thead>
								<tr>
									<th scope="col">ID</th>
									<th scope="col">Nome</th>
									<th scope="col">Contato</th>
									<th scope="col"></th>
									<th scope="col"></th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" class="btnListar" onclick="listarTodos()">Listar
						todos</button>

					<button type="button" class="btnFechar" data-bs-dismiss="modal">Fechar</button>
				</div>
			</div>
		</div>
	</div>

	<!-- JQuery -->

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"
		integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
		crossorigin="anonymous">
		
	</script>

	<!-- Option 1: Bootstrap Bundle with Popper -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous">
		
	</script>

	<!-- Fun√ß√£o Buttons -->

	<script>
		function salvar() {
			var id = $("#id").val();
			var nome = $("#nome").val();
			var contato = $("#contato").val();

			if (nome == null || nome != null && nome.trim() == '') {
				$("#nome").focus();
				alert('O campo nome est√° vazio.');
				return;
			}

			$.ajax({
				method : "POST",
				url : "salvar",
				data : JSON.stringify({
					id : id,
					nome : nome,
					contato : contato
				}),
				contentType : 'application/json; charset=utf-8',
				success : function(response) {
					$("#id").val(response.id);
					alert("Salvado com sucesso!")
				}
			}).fail(function(xhr, status, errorThrown) {
				alert("Erro ao salvar: " + xhr.responseText);
			});
		}

		function limpar() {
			document.getElementById('form').reset();
		}

		function buscar() {
			nome = $('#nomeBuscar').val();

			if (nome != null && nome.trim() != '') {
				$
						.ajax(
								{
									method : "GET",
									url : "buscarNome",
									data : "nome=" + nome,
									success : function(response) {
										$('#tabelaResultado > tbody > tr')
												.remove();

										for (var i = 0; i < response.length; i++) {
											$('#tabelaResultado > tbody')
													.append(
															'<tr id="'+response[i].id+'"><td>'
																	+ response[i].id
																	+ '</td><td>'
																	+ response[i].nome
																	+ '</td><td>'
																	+ response[i].contato
																	+ '</td><td>	<span class="btnIcon editar" onclick="edicao('
																	+ response[i].id
																	+ ')">üìù</span></td><td><span class="btnIcon apagar" onclick="apagar('
																	+ response[i].id
																	+ ')">‚ùå</span></td></tr>');
										}
									}
								}).fail(function(xhr, status, errorThrown) {
							alert("Erro ao buscar: " + xhr.responseText);
						});

			}
		}

		function listarTodos() {
			$
					.ajax(
							{
								method : "GET",
								url : "listarTodos",
								success : function(response) {
									$('#tabelaResultado > tbody > tr').remove();

									for (var i = 0; i < response.length; i++) {
										$('#tabelaResultado > tbody')
												.append(
														'<tr id="'+response[i].id+'"><td>'
																+ response[i].id
																+ '</td><td>'
																+ response[i].nome
																+ '</td><td>'
																+ response[i].contato
																+ '</td><td>	<span class="btnIcon editar" onclick="edicao('
																+ response[i].id
																+ ')">üìù</span></td><td><span class="btnIcon apagar" onclick="apagar('
																+ response[i].id
																+ ')">‚ùå</span></td></tr>');
									}
								}
							}).fail(function(xhr, status, errorThrown) {
						alert("Erro ao buscar: " + xhr.responseText);
					});
		}

		function edicao(id) {

			$.ajax({
				method : "GET",
				url : "buscarId",
				data : "id=" + id,
				success : function(response) {

					$("#id").val(response.id);
					$("#nome").val(response.nome);
					$("#contato").val(response.contato);

					$('#modalPesquisar').modal('hide')

				}
			}).fail(function(xhr, status, errorThrown) {
				alert("Erro ao buscar contato por ID: " + xhr.responseText);
			});
		}

		function apagar(id) {

			if (confirm('Deseja realmente apagar este contato?')) {

				$.ajax({
					method : "DELETE",
					url : "deletar",
					data : "id=" + id,
					success : function(response) {

						$('#' + id).remove();

						alert(response);
					}
				}).fail(
						function(xhr, status, errorThrown) {
							alert("Erro ao deletar contato por ID: "
									+ xhr.responseText);
						});

			}
		}
	</script>
</body>
</html>